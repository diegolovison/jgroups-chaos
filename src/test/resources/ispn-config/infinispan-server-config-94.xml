<?xml version="1.0"?>
<xsl:stylesheet
      xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:endpoint="urn:infinispan:server:endpoint:9.4"
      xmlns:serverCore="urn:infinispan:server:core:9.4"
      version="1.0">

   <xsl:output omit-xml-declaration="no" indent="yes"/>
   <xsl:strip-space elements="*"/>

   <!-- Copy as is -->
   <xsl:template match="node()|@*">
      <xsl:copy>
         <xsl:apply-templates select="node()|@*"/>
      </xsl:copy>
   </xsl:template>

   <xsl:template match="serverCore:subsystem">
      <subsystem xmlns="urn:infinispan:server:core:9.4" default-cache-container="clustered">
         <cache-container name="clustered" default-cache="local-cache" statistics="true">
            <transport lock-timeout="60000"/>
            <local-cache name="local-cache"/>
            <distributed-cache name="testMaxIdleExpiration" owners="2" segments="30" mode="ASYNC" remote-timeout="30000" start="EAGER">
               <locking isolation="READ_COMMITTED" striping="false" acquire-timeout="30000" concurrency-level="1000"/>
               <transaction mode="NONE"/>
               <memory>
                  <object size="4000000"/>
               </memory>
               <expiration max-idle="20000" lifespan="300000"/>
               <persistence passivation="true">
                  <file-store max-entries="1000000" relative-to="jboss.server.data.dir" path="cache" name="cache" shared="false" preload="false" fetch-state="true" purge="true"/>
               </persistence>
            </distributed-cache>
         </cache-container>
      </subsystem>
   </xsl:template>
   <xsl:template match="endpoint:subsystem">
      <subsystem xmlns="urn:infinispan:server:endpoint:9.4">
         <hotrod-connector socket-binding="hotrod" cache-container="clustered">
            <topology-state-transfer lazy-retrieval="false" lock-timeout="1000" replication-timeout="5000"/>
         </hotrod-connector>
         <rest-connector socket-binding="rest" cache-container="clustered"/>
      </subsystem>
   </xsl:template>
</xsl:stylesheet>